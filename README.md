# terraform-foreman
Foreman provider for Terraform

**Note, I'm a DevOps Engineer who has come from a predominately Ops world. I have never written in Go previously instead prefering Ruby, Python, Javascript, Java or Bash. Hence this code may actually be completely wrong! Use this at your own risk! If you'd like to contribute please do, see the instructions below!**

## What is Terraform
Terraform is an orchestration tool that can be used to deploy and manage the lifecycle of cloud resources such as virtual machines, DNS records etc.
That probably isn't giving it enough credit so check it out at [https://terraform.io/]

## What is Foreman
Foreman (or more accurately TheForeman) is a Red Hat sponsored open source tool used to manage infrastructure in a Private Cloud. Foreman can provision for instance Docker instances, Virtual Machines in OpenStack or VMWare and it can even deploy to bare metal. Foreman ties into PuppetLabs Puppet infrastructure and provides ENC data regarding the servers it manages. Check it out at [http://theforeman.org/]

## Usage

Add the following to your ~/.terraformrc
```
providers {
     foreman = "/path/to/bin/terraform-foreman"
}
```

Sample terraform config. Save this as a example.tf or similar
```
resource "foreman_dns" "example" {
	host = "example.com"
}


resource "foreman_server" "example" {
    name = "host${count.index}.example.com"
    location_id = 1
    organization_id = 1
    puppet_class_ids = ["1","2","3"]
    count = 3
}

resource "foreman_server" "complex_VM" {
    name = "complex.example.com"
    location_id = 1		# ID of foreman location, if locations are enabled
    organization_id = 2		# ID of foreman organization, if orgs are enabled
    environment_id = 4		# ID of foreman environment
    ip = "10.12.2.2"
    mac = "00:50:56:8f:29:73"
    architecture_id = 1 	# x86_64
    domain_id = 1		# "First foreman domain"
    puppet_proxy_id = 2		# ID of your puppet master defined in foreman
    puppet_class_ids = ["351"]  # Puppet class ids
    operatingsystem_id = 1	# ID of a foreman operating system
    medium_id = 7		# ID of a foreman repository
    ptable_id = 3		# ID of a foreman partition table
    subnet_id = 3		# ID of a foreman subnet
    compute_resource_id = 1	# ID of a foreman compute resource, for example vCenter, docker, openstack nova
    model_id = 1		# ID of a foreman compute model
    owner_id = 17		# ID of a foreman user, likely that of the service account used to create it
    puppet_ca_proxy_id = 2	# ID of your puppet CA master defined in foreman
    build = false		# Build mode, determines if the PXE configs are generated by foreman
    enabled = true		# Enabled?? NFI
    provision_method = "build"  
    managed = true		
    comment = ""
}
```

if you have already built the terraform-foreman source then you are ready to test. Navigate to the directory where you saved your terraform config (example.tf) and execute:

```
terraform plan
```

this should output something similar to


if you have already planned the terraform resources you can taint them essentially marking them to be rebuilt

```
# Taint the complex example vm
terraform taint foreman_server.complex_VM
```

## Build
In order to build/install the source, navigate to the checked out directory and ensure your $GOPATH is defined.

Execute
```
go install
```
## Contributing
If you'd like to contribute to this codebase please do!

I would be more than pleased if you did but please remember I am not a programmer by default. Go easy on me! lol

#### Instructions
```
# Fork it on GitHub
git clone https://github.com/your_name/terraform-foreman.git
cd terraform-foreman
git checkout -b my_awesome_feature_branch master
# Make your awesome changes
git commit -a -m "my awesome changes explained"
# Repeat till your happy
git push origin my_awesome_feature_branch
# Submit a pull request at https://github.com/your_name/terraform-foreman
# Explain your changes in PR and include test instrcutions.
# I'll hopefully accept it and we'll be on our way to shared awesomeness.
```



